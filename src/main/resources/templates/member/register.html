<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<!-- include CSS File -->
<th:block layout:fragment="css">
	<!-- Handa Member CSS File -->
	<link th:href="@{/assets/css/member.css}" rel="stylesheet">
</th:block>

<div layout:fragment="content">


	<main id="main">

		<!-- ======= Breadcrumbs ======= -->
		<div class="breadcrumbs">
			<div class="page-header d-flex align-items-center">
				<div class="container position-relative">
					<div class="row d-flex justify-content-center">
						<div class="col-lg-6 text-center">
							<h2>Register</h2>
							<p>정보를 입력해 주세요</p>
						</div>
					</div>
				</div>
			</div>

			<!-- <nav>
		<div class="container">
			<ol>
				<li><a href="/">홈</a></li>
				<li>회원가입</li>
			</ol>
		</div>
	</nav> -->
		</div>
		<!-- End Breadcrumbs -->

		<section class="sample-page register-padding-top-0">
			<div class="container" data-aos="fade-up"></div>
		</section>

		<!-- ======= Services Section ======= -->
		<section id="service" class="services pt-0">
			<div class="container" data-aos="fade-up">

				<div class="section-header">
					<h2>회원가입</h2>
				</div>
				<section id="contact" class="contact register-padding-top-30px">
					<div class="text-center">
						<div class="stepper-wrapper">
							<div class="stepper-item completed">
								<div class="step-counter">
									<i class="fa-solid fa-pen"></i>
								</div>
								<div class="step-name">정보입력</div>
							</div>
							<div class="stepper-item">
								<div class="">></div>
							</div>
							<div class="stepper-item">
								<div class="step-counter">
									<i class="fa-solid fa-envelope"></i>
								</div>
								<div class="step-name">메일인증</div>
							</div>
						</div>
						<div class="register-div">
							<div class="line-div">
								<small style="color: #5c7fdd;">*</small> <small> 필수 입력
									사항</small>
							</div>
							<form action="" method="post" role="form" class="register-form">
								<div class="row" style="margin:0;">
									<div class="form-group mt-3 row">
										<div class="register-label-style col-3">
											<label class="login-label">아이디<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-7">
											<input type="text" name="member_id" class="form-control" maxlength="12"
												id="memberid" placeholder="아이디를 입력해주세요. (12자 이내)" required>
										</div>
										<button class="id-check col-2">중복확인</button>

									</div>
									<div class="form-group mt-3 row">
										<div class="col-3 register-label-style">
											<label class="login-label">비밀번호<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-7">
											<input type="password" class="form-control" name="password"
												id="password" placeholder="비밀번호를 입력해주세요." required=""
												maxlength="13"> <p
												style="font-size: 13px; color: #777;" class="vaild-check">8~13자 영문, 숫자
												조합을 사용하세요.</p>
												 <p style="font-size: 13px;" class="vaild-check" id="pw-input-check"></p>
										</div>
									</div>
									<div class="form-group mt-3 row">
										<div class="col-3 register-label-style">
											<label class="login-label">비밀번호 확인<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-7">
											<input type="password" class="form-control"
												id="password-check" placeholder="비밀번호를 한번 더 입력해주세요."
												required maxlength="13">
											<p style="font-size: 13px;" class="vaild-check" id="pw-double-check"></p>
										</div>
									</div>

									<div class="form-group mt-3 row">
										<div class="col-3 register-label-style">
											<label class="login-label">이름<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-7">
											<input type="text" class="form-control" id="member-name"
												name="member_name" placeholder="이름을 입력해주세요." maxlength="10"
												required>
										</div>
									</div>

									<div class="form-group mt-3 row">
										<div class="col-3 register-label-style">
											<label class="login-label">
												전화번호<small style="color: #5c7fdd;">*</small>
											</label>
										</div>
										<div class="col-7">
											<input type="text" class="form-control" id="member-call"
												name="member_call" placeholder="숫자만 입력해주세요." required
												maxlength="13">
										</div>
									</div>
									<div class="form-group mt-3 row">
										<div class="register-label-style col-3">
											<label class="login-label">e-mail<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-7">
											<input type="text" class="form-control" id="e-mail"
												name="e_mail" placeholder="예 : handa@hansol.com" required>
											<p style="font-size: 13px; color: #777;" class="vaild-check">
											작성하신 메일 주소로 인증 메일이 전송됩니다.
											</p>
											<p class="vaild-check" id="e-mail-check">
											</p>
										</div>

									</div>
									<div class="form-group mt-3 row">
										<div class="register-label-style col-3">
											<label class="login-label">성별<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-9 gender-div">
											<input type="radio" id="select" name="gender" class="form-check-input" value="남" checked="checked">
											<label for="select" class="form-check-label">남자</label> 
											<input type="radio" id="select2" class="form-check-input"
											name="gender" value="여">
											<label for="select2" class="form-check-label">여자</label>
										</div>
									</div>
									<div class="form-group mt-3 row">
										<div class="register-label-style col-3">
											<label class="login-label">회사<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-7">
											<select class="form-select" name="affiliates_id">
												<option selected disabled style="display: none;">회사를 선택해주세요.</option>
												<option value="1">한솔 인티큐브</option>
												<option value="2">한솔 제지</option>
												<option value="3">한솔 테크닉스</option>
												<option value="4">한솔 페이퍼택</option>
												<option value="5">한솔 홀딩스</option>
												<option value="6">한솔 문화재단</option>
												<option value="7">한솔 케미칼</option>
												<option value="8">한솔 홈데코</option>
												<option value="9">한솔 코에버</option>
												<option value="10">한솔 BS</option>
												<option value="11">한솔 PNS</option>
												<option value="12">한솔 로지스틱스</option>
											</select>
										</div>
									</div>
									<div class="form-group mt-3 row">
										<div class="register-label-style col-3">
											<label class="login-label">직급<small
												style="color: #5c7fdd;">*</small></label>
										</div>
										<div class="col-7">
											<select class="form-select" name="position_id">
												<option selected disabled  style="display: none;">직급을 선택해주세요.</option>
												<option value="4">팀장</option>
												<option value="1">수석</option>
												<option value="2">책임</option>
												<option value="3">선임</option>
											</select>
										</div>
									</div>


								</div>
								<div class="text-center register-btn-div">
									<button class="handa-btn" type="submit">회원가입</button>
								</div>
							</form>
						</div>
						<!-- End Contact Form -->
						<input type="hidden" th:value="${msg}" class="register-result" />
					</div>
				</section>
			</div>
		</section>
		<!-- End Services Section -->

	</main>
	<!-- End #main -->
</div>

<th:block layout:fragment="javascript">
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		$(document).ready(function() {
			// console.log($('#memberid').val());
			let idCheckConfirm = false;

			$(".id-check").on("click", function(e) {

				e.preventDefault();

				// console.log("버튼 쿨릭 테스트")

				const memberId = $('#memberid').val();

				if (memberId == "") {
					Swal.fire({
						icon : 'error',
						text : '아이디를 입력하세요.'
					})
					return;
				}

				$.ajax({
					type : 'post',
					url : "/member/idcheck",
					data : {
						'member_id' : memberId
					},
					success : function(data) {
						// 0 : 가입 가능, 1 : 가입 불가 (중복 O)
						if (data === 1) {
							Swal.fire({
								icon : 'error',
								text : '이미 존재하는 아이디입니다.'
							})
							$('#memberid').val("");

							idCheckConfirm = false;
						}

						if (data === 0) {
							Swal.fire({
								icon : 'success',
								text : '사용할 수 있는 아이디입니다.'
							})

							idCheckConfirm = true;
						}
					}
				});
			});
			
			$(".register-form").keydown(function (event) {
				if (event.keyCode == '13') {
					if (window.event) {
						event.preventDefault();                
						return;          
						}        
					} 
				});
			

			if ($(".register-result").val() === "register-fail") {
				Swal.fire({
					icon : 'error',
					text : '가입을 다시 진행해주세요.'
				})
			}

			function loadSwal(text) {
				Swal.fire({
					icon : 'error',
					text : text
				})
			}
			
			$("#member-call").keyup(function(e) {
				const target = $(this)[0];
				// console.log(target);
				target.value = target.value
				   .replace(/[^0-9]/g, '')
				  .replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/g, "$1-$2-$3").replace(/(\-{1,2})$/g, "");
			});
			
			$("#e-mail").keyup(function(e) {
				const target = $(this);
				const regExp = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;
				
				
				if (regExp.test(target.val())) {				
					console.log('올바른 이메일 형식입니다.');
					$("#e-mail-check").text('올바른 이메일 형식입니다.');
					$("#e-mail-check").css('color', 'green');
				} else {
					$("#e-mail-check").text('이메일 형식이 올바르지 않습니다.');
					$("#e-mail-check").css('color', 'red');
				}
			});
			
			$("#password").keyup(function(e) {
				const target = $(this);
				const regPassword = /^(?=.*[a-zA-Z])(?=.*[0-9]).{8,13}$/;
				// #pw-input-check
				if (regPassword.test(target.val())) {	
					// console.log('O')
					$("#pw-input-check").css('display', 'none');
				} else {
					// console.log('X')
					$("#pw-input-check").css('display', 'block');
					$("#pw-input-check").text('비밀번호를 조건에 맞게 작성하세요.');
					$("#pw-input-check").css('color', 'red');
				}
			});
			
			$("#password-check").keyup(function(e) {
				const passwordCheck = $(this).val();
				const password = $("#password").val();
				
				if (passwordCheck != password) {
					$("#pw-double-check").css('display', 'block');
					$("#pw-double-check").text('비밀번호가 일치하지 않습니다.');
					$("#pw-double-check").css('color', 'red');
				} else {
					$("#pw-double-check").css('display', 'none');
				}
			});

			$(".register-btn-div button").on("click", function(e) {

				e.preventDefault();

				// console.log("버튼 쿨릭 테스트")
				const memberId = $("#memberid");
				const password = $("#password").val();
				const passwordCheck = $("#password-check").val();
				const memberName = $("#member-name").val();
				const memberCall = $("#member-call").val();
				const memberEmail = $("#e-mail").val();
				const gender = $('input[name=gender]');
				const affiliates = $('select[name=affiliates_id]');
				const position = $('select[name=position_id]');

				// 회원가입 데이터 유효성 검사
				// 아이디 중복 체크 여부 확인
				if (idCheckConfirm === false) {

					loadSwal('아이디 중복확인을 해주세요.');

					return;
				}

				// 비밀번호 작성 여부 & 영문 + 숫자 13자리 이상
				if (password == "") {

					loadSwal('비밀번호를 작성 해주세요.');

					return;
				}

				const regPassword = /^(?=.*[a-zA-Z])(?=.*[0-9]).{8,13}$/;

				if (!regPassword.test(password)) {

					loadSwal('8~13 자 영문, 숫자 조합을 사용하세요.');

					return;
				}

				// 비밀번호 확인 작성 여부 & 비밀번호와 확인이 일치하는지 확인
				if (passwordCheck == "") {

					loadSwal('비밀번호 확인을 작성 해주세요.');

					return;

				}

				if (passwordCheck != password) {

					loadSwal('비밀번호 확인을 다시 작성 해주세요.');

					return;

				}

				// 이름 작성여부 확인 & 10자 이하
				if (memberName == "") {

					loadSwal('이름을 작성 해주세요.');

					return;

				}

				if (memberName.length > 10) {

					loadSwal('이름은 10자 이하만 가능합니다.');

					return;

				}

				// 전화번호 작성여부 확인 & 중간에 '-' 표시 넣기 & 전화번호 길이 확인
				if (memberCall == "" || memberCall.length != 13) {

					loadSwal('전화번호를 작성 해주세요.');

					return;
				}

				// email 작성여부 확인 & 형식에 맞게 작성했는지 확인
				if (memberEmail == "") {

					loadSwal('이메일을 작성 해주세요.');

					return;

				}
				
				const regExp = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;
				
				if (!regExp.test(memberEmail)) {
					
					loadSwal('이메일을 형식에 맞게 작성 해주세요.');

					return;
				}

				// 성별 버튼 클릭 안되어있으면 경고창 표시
				if (!gender.is(":checked")) {

					loadSwal('성별을 선택 해주세요.');

					return;

				}

				// 회사, 직급 선택여부 확인
				if (!affiliates.val() || !position.val()) {

					loadSwal('회사/직급 정보를 선택 해주세요.');

					return;

				}

				// 폼 전송
				$(".register-form").attr("action", "/member/register");
				$(".register-form").submit();
			});

		});
	</script>
</th:block>

</html>