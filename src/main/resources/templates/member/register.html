<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<!-- include CSS File -->
<th:block layout:fragment="css">
	<!-- Handa Member CSS File -->
	<link th:href="@{/assets/css/member.css}" rel="stylesheet">
</th:block>

<div layout:fragment="content">
<main id="main">

<!-- ======= Breadcrumbs ======= -->
<div class="breadcrumbs">
	<div class="page-header d-flex align-items-center">
		<div class="container position-relative">
			<div class="row d-flex justify-content-center">
				<div class="col-lg-6 text-center">
					<h2>Register</h2>
					<p>정보를 입력해 주세요</p>
				</div>
			</div>
		</div>
	</div>

	<nav>
		<div class="container">
			<ol>
				<li><a href="/">홈</a></li>
				<li>회원가입</li>
			</ol>
		</div>
	</nav>
</div>
<!-- End Breadcrumbs -->

<section class="sample-page register-padding-top-0">
	<div class="container" data-aos="fade-up"></div>
</section>

<!-- ======= Services Section ======= -->
<section id="service" class="services pt-0">
	<div class="container" data-aos="fade-up">

		<div class="section-header">
			<h2>회원가입</h2>
		</div>
		<section id="contact" class="contact register-padding-top-30px">
			<div class="text-center">
				<div class="register-step">
					<h5><span style="color: #86a0e6;">1단계(정보입력)</span> > <span>2단계(메일 인증)</span></h5>
				</div>
				<div class="register-div">
					<form action="" method="post" role="form" class="register-form">
						<div class="row">
							<div class="form-group mt-3">
								<div class="register-label-style">
									<label class="login-label"><b>아이디</b></label>
								</div>
								<table class="register-width100">
									<tr>
										<td class="register-width100"><input type="text"
											name="member_id" class="form-control" id="memberid"
											placeholder="아이디" required></td>
										<td>
											<button class="btn btn-primary register-button-width id-check">중복확인</button>
										</td>
								</table>
							</div>
							<div class="form-group mt-3">
								<div class="register-label-style">
									<label class="login-label"><b>비밀번호</b></label>
								</div>
								<input type="password" class="form-control" name="password"
									id="password" placeholder="비밀번호" required="" maxlength="13">
									<span style="font-size: 13px; color: #777;">8~13자 영문, 숫자 조합을 사용하세요.</span>
							</div>
							<div class="form-group mt-3">
								<div class="register-label-style">
									<label class="login-label"><b>비밀번호 확인</b></label>
								</div>
								<input type="password" class="form-control"
									id="password-check" placeholder="비밀번호 확인" required="" maxlength="13">
							</div>

							<div class="form-group mt-3">
								<div class="register-label-style">
									<label class="login-label"><b>이름</b></label>
								</div>
								<input type="text" class="form-control" id="member-name"
									name="member_name" placeholder="이름" maxlength="10" required="">
							</div>

							<div class="form-group mt-3">
								<div class="register-label-style">
									<label class="login-label"><b>전화번호</b></label>
								</div>
								<input type="text" class="form-control" id="member-call"
									name="member_call" placeholder="전화번호" required="" maxlength="13">
							</div>
							<div class="form-group mt-3">
								<div class="register-label-style">
									<label class="login-label"><b>e-mail</b></label>
								</div>
								<input type="text" class="form-control" id="e-mail"
									name="e_mail" placeholder="e-mail" required="">
							</div>
							<div class="form-group mt-3">
								<div class="register-label-style">
									<label class="login-label"><b>성별</b></label>
								</div>
								<div class="register-float-right select">
									 <input type="radio" id="select" name="gender" value="남"><label for="select">남</label>
     								<input type="radio" id="select2" name="gender" value="여"><label for="select2">여</label>
								</div>
							</div>
							<div class="form-group mt-3">
								<table class="register-width100">
									<tr>
										<td><label class="login-label register-label-style"><b>회사</b></label></td>
									</tr>
									<tr>
										<td><select class="form-select"
											name="affiliates_id">
												<option value="0">-- 선택 --</option>
												<option value="1">한솔 인티큐브</option>
												<option value="2">한솔 제지</option>
												<option value="3">한솔 테크닉스</option>
												<option value="4">한솔 페이퍼택</option>
												<option value="5">한솔 홀딩스</option>
												<option value="6">한솔 문화재단</option>
												<option value="7">한솔 케미칼</option>
												<option value="8">한솔 홈데코</option>
												<option value="9">한솔 코에버</option>
												<option value="10">한솔 BS</option>
												<option value="11">한솔 PNS</option>
												<option value="12">한솔 로지스틱스</option>
										</select></td>
									</tr>
								</table>
							</div>
							<div class="form-group mt-3">
								<table class="register-width100">
									<tr>
										<td><label class="login-label register-label-style"><b>직급</b></label></td>
									</tr>
									<tr>
										<td><select class="form-select"
											name="position_id">
												<option value="0">-- 선택 --</option>
												<option value="1">수석</option>
												<option value="2">책임</option>
												<option value="3">선임</option>
										</select></td>
									</tr>
								</table>
							</div>
							

						</div>
						<div class="text-center register-btn-div">
							<button type="submit">회원가입</button>
						</div>
					</form>
				</div>
				<!-- End Contact Form -->
					<input type="hidden" th:value="${msg}" class="register-result"/>
			</div>
		</section>
	</div>
</section>
<!-- End Services Section -->

</main>
<!-- End #main -->
</div>

<th:block layout:fragment="javascript">
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
	
	$(document).ready(function(){
		// console.log($('#memberid').val());
			let idCheckConfirm = false;
		
	$(".id-check").on("click", function (e) {
		
	        
	        e.preventDefault();
	        
	        // console.log("버튼 쿨릭 테스트")
	        
	        const memberId = $('#memberid').val();
	        
	        if (memberId == "") {
				Swal.fire({
					  icon: 'error',
					  text: '아이디를 입력하세요.'
				})
				return;
	        }
	        
		$.ajax({
			type: 'post',
			url: "/member/idcheck",
			data: { 'member_id': memberId },
			success: function (data) {
				// 0 : 가입 가능, 1 : 가입 불가 (중복 O)
				if (data === 1) {
					Swal.fire({
						  icon: 'error',
						  text: '이미 존재하는 아이디입니다.'
					})
					$('#memberid').val("");
					
					idCheckConfirm = false;
				}
			
				if (data === 0) {
					Swal.fire({
						  icon: 'success',
						  text: '사용할 수 있는 아이디입니다.'
					})
					
					idCheckConfirm = true;
				}
			}
		});
	});
		
		
	if ($(".register-result").val() === "register-fail") {			
		Swal.fire({
			  icon: 'error',
			  text: '가입을 다시 진행해주세요.'
		})
	}
	
	function loadSwal(text) {
		Swal.fire({
			  icon: 'error',
			  text: text
		})
	}
	
	$(".register-btn-div button").on("click", function (e) {
        
        e.preventDefault();
        
        // console.log("버튼 쿨릭 테스트")
        const memberId = $("#memberid");
        const password = $("#password").val();
        const passwordCheck = $("#password-check").val();
        const memberName = $("#member-name").val();
        const memberCall = $("#member-call").val();
        const memberEmail = $("#e-mail").val();
        const gender = $('input[name=gender]');
        const affiliates = $('select[name=affiliates_id]');
        const position = $('select[name=position_id]');
        
        // 회원가입 데이터 유효성 검사
		// 아이디 중복 체크 여부 확인
    	if (idCheckConfirm === false) {
	
    		loadSwal('아이디 중복확인을 해주세요.');
	
    		return;	
    	}
		
		// 비밀번호 작성 여부 & 영문 + 숫자 13자리 이상
		if (password == "") {
			
			loadSwal('비밀번호를 작성 해주세요.');
			
  			return;
		}
		
		const regPassword = /^[A-Za-z0-9]{8,13}$/;
		
		if (!regPassword.test(password)) {
			
			loadSwal('8~13 자 영문, 숫자 조합을 사용하세요.');
			
  			return;
		}
		
		// 비밀번호 확인 작성 여부 & 비밀번호와 확인이 일치하는지 확인
		if (passwordCheck == "") {
			
			loadSwal('비밀번호 확인을 작성 해주세요.');
			
  			return;
			
		}
		
		if (passwordCheck != password) {
			
			loadSwal('비밀번호 확인을 다시 작성 해주세요.');
			
  			return;
			
		}
		
		// 이름 작성여부 확인 & 10자 이하
		if (memberName == "") {
			
			loadSwal('이름을 작성 해주세요.');
			
  			return;
			
		}
		
		if (memberName.length > 10) {
			
			loadSwal('이름은 10자 이하만 가능합니다.');
			
  			return;
			
		}
		
		// 전화번호 작성여부 확인 & 중간에 '-' 표시 넣기
		if (memberCall == "") {
			
			loadSwal('전화번호를 작성 해주세요.');
			
  			return;
			
		}
		
		// email 작성여부 확인 & 형식에 맞게 작성했는지 확인
		if (memberEmail == "") {
			
			loadSwal('이메일을 작성 해주세요.');
			
  			return;
			
		}
		
		// 성별 버튼 클릭 안되어있으면 경고창 표시
		if (!gender.is(":checked")) {
			
			loadSwal('성별을 선택 해주세요.');
			
  			return;
			
		}
		
		// 회사, 직급 선택여부 확인
		if (affiliates.val() == 0 || position.val() == 0) {
					
			loadSwal('회사/직급 정보를 선택 해주세요.');
			
  			return;
			
		}
		
		
		

		// 폼 전송
        $(".register-form").attr("action", "/member/register");
        $(".register-form").submit();
    });
	
	

		
});
</script>
</th:block>

</html>